{% extends "imagetask/base.html" %}
{% block title %}{{ block.super }} :: student{% endblock %}
{% load staticfiles %}


{% block content %}
<center><h1>Student</h1></center>
<hr>
<div class="row">
    <div id="slots" class="col-lg-7 col-centered">
        <div></div>
        <div></div>
        <div></div>
    </div>
</div>
<hr>
<div class="row">
    <div id="image_options" class="col-lg-12 col-centered">
        {% for image in images %}
        <img src="{{ image.file.url }}" id="img{{ image.id }}" width="{{ image.file.width }}" height="{{ image.file.height }}">
        {% endfor %}
    </div>
</div>
<hr>
<center><button type="button" class="btn btn-primary btn-lg">Submit</button></center>
{% endblock %}


{% block css %}
<style media="screen" type="text/css">
    .col-centered {
        float: none;
        margin: 0 auto;
    }

    #slots div {
        float: left;
        width: 200px;
        height: 300px;
        padding: 10px;
        padding-top: 40px;
        padding-bottom: 0;
        border: 2px solid #333;
        -moz-border-radius: 10px;
        -webkit-border-radius: 10px;
        border-radius: 10px;
        margin: 0 0 0 10px;
        background: #fff;
    }

    #slots div.hovered {
        background: #aaa;
    }

    #image_options img {
        cursor: move;
    }

    #image_options img.ui-draggable-dragging {
        -moz-box-shadow: 0 0 1em rgba(0, 0, 0, .8);
        -webkit-box-shadow: 0 0 1em rgba(0, 0, 0, .8);
        box-shadow: 0 0 1em rgba(0, 0, 0, .8);
    }
</style>
{% endblock %}


{% block js %}
<script src="{% static "js/jquery-ui-1.10.4.min.js" %}"></script>
<script>
    function imageId(img) {
        return $(img).attr('id').substring(3);
    }

    function handleImageDrop(event, ui) {
        var image_id = $(this).data('image_id');

        // if slot already contains an image
        // reset image to original position
        if (image_id) {
            $('#' + image_id).draggable('option', 'revert', true);
            $('#' + image_id).css({
                'left': $('#' + image_id).data('orig_left'),
                'top': $('#' + image_id).data('orig_top')
            });
        }

        ui.draggable.position({of: $(this)});
        ui.draggable.draggable('option', 'revert', false);

        var draggable_id = ui.draggable.attr('id');

        // if image moved from one slot to another
        // delete id from old slots
        $('#slots div').each(function () {
            if ($(this).data('image_id') == draggable_id) {
                $(this).data('image_id', null);
            }
        });

        // save image id in slot
        $(this).data('image_id', draggable_id);
    }

    $(document).ready(function () {
        // remember original positions
        $('#image_options img').each(function () {
            $(this).data('orig_left', $(this).css('left'));
            $(this).data('orig_top', $(this).css('top'));
        });

        $('#image_options img').draggable({
            stack: '#image_options img',
            cursor: 'move',
            revert: true
        });

        $('#slots div').droppable({
            accept: '#image_options img',
            hoverClass: 'hovered',
            drop: handleImageDrop
        });
    });
</script>
{% endblock %}
